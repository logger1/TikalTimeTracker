<strong><!DOCTYPE html>
<html>
  <head>
  <title></title>
  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
	<meta charset="utf-8">


	<!-- iPad/iPhone specific css below, add after your main css >
	<link rel="stylesheet" media="only screen and (max-device-width: 1024px)" href="ipad.css" type="text/css" />		
	<link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="iphone.css" type="text/css" />		
	-->
	<!-- If your application is targeting iOS BEFORE 4.0 you MUST put json2.js from http://www.JSON.org/json2.js into your www directory and include it here -->
	
	<link rel="stylesheet"  href="css/themes/default/jquery.mobile-1.1.0.min.css" />
	<link rel="stylesheet" href="mapapp.css" type="text/css">
	<script type="text/javascript" charset="utf-8" src="cordova-1.6.0.js"></script>
	<script src="js/jquery.js"></script>
	<script src="js/jquery.mobile-1.1.0.min.js"></script>  
	<script src="js/jquery.tmpl.min.js"></script>  
	<script src="js/jquery.json-2.3.min.js" type="text/javascript"></script>
	<script src="js/foursquare-js-api.js" type="text/javascript"></script>
	<script type="text/javascript" charset="utf-8" src="lib/globals.js"></script>
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
	<script type="text/javascript" src="lib/ui/min/jquery.ui.map.full.min.js"></script>
	<script type="text/javascript" src="lib/ui/min/jquery.ui.map.services.min.js"></script>
	
	<script type="text/javascript">


	// If you want to prevent dragging, uncomment this section
	/*
	function preventBehavior(e) 
	{ 
      e.preventDefault(); 
    };
	document.addEventListener("touchmove", preventBehavior, false);
	*/
	
	/* If you are supporting your own protocol, the var invokeString will contain any arguments to the app launch.
	see http://iphonedevelopertips.com/cocoa/launching-your-own-application-via-a-custom-url-scheme.html
	for more details -jm */
	/*
	function handleOpenURL(url)
	{
		// TODO: do something with the url passed in.
	}
	*/
	
	/* When this function is called, Cordova has been initialized and is ready to roll */
	/* If you are supporting your own protocol, the var invokeString will contain any arguments to the app launch.
	see http://iphonedevelopertips.com/cocoa/launching-your-own-application-via-a-custom-url-scheme.html
	for more details -jm */
	function onBodyLoad() { document.addEventListener("deviceready", onDeviceReady, false); }

	/* When this function is called, PhoneGap has been initialized and is ready to roll */
	/* If you are supporting your own protocol, the var invokeString will contain any arguments to the app launch.
	see http://iphonedevelopertips.com/cocoa/launching-your-own-application-via-a-custom-url-scheme.html
	for more details -jm */
	function onDeviceReady()
	{
		// do your thing!
		fsclient = new FourSquareClient(fsAPI_KEY, fsAPI_SECRET, "", true);
	}
        
	var root = this;
	var fsclient
	var currentLocation;
	var currentLandL;
	var nearbyLocations;
	var fsAPI_KEY = "1OYPMZW55HEI5CHOJ0AH4EGJATOF0TQD3Z03PRNAJZIKWTPM";
	var fsAPI_SECRET = "HG4IHVAI4E01RFR135PLJ5TERNKYTDAGQWG0VUSRWEGIKLIG";
        
	function doSelectLocation(id) {
		jQuery.each(nearbyLocations, function() {
			if( id == this.id) {
				currentLocation = this;
				$.mobile.changePage("#mainPage", { transition: "slide"});
				displayCurrentLocation(currentLocation);
				return;
			}
		});
	}
        
	function showMapForLocation(id) {
		jQuery.each(nearbyLocations, function() {
			if( id == this.id) {
				currentLocation = this;
				$.mobile.changePage("#map_page", { transition: "slide"});
				return;
			}
		});
	}
        
	function displayCurrentLocation(currentLocation) {
		$( "#locationContainer" ).text("You have picked: " + currentLocation.name);
	}
        
	function doCheckIn() {}
        
	function retrieveLocations(){
		$.mobile.showPageLoadingMsg();
		navigator.geolocation.getCurrentPosition(onSuccess, onError);
	}
        
	// onSuccess Callback
	//   This method accepts a `Position` object, which contains
	//   the current GPS coordinates
	//
	var onSuccess = function(position) {
		currentLandL = position.coords.latitude+","+position.coords.longitude;
		var parameters = {
			ll: currentLandL, 
			limit: '10', 
			radius: '550'
		};
		fsclient.venuesClient.search(parameters, {
			onSuccess: function(data) {
				nearbyLocations = data.response.venues;
				//alert(nearbyLocations);
				$.mobile.changePage("#selectlocation", { transition: "slide"});
				$.mobile.hidePageLoadingMsg();														
				var list = $( "#selectlocation" ).find( ".locationlist" );
				//Empty current list
				list.empty();
				//Use template to create items & add to list
				$( "#locationItem" ).tmpl( nearbyLocations ).appendTo( list );
				//Call the listview jQuery UI Widget after adding 
				//items to the list allowing correct rendering
				list.listview( "refresh" ); 
			},
			onFailure: function(data) {
				alert('Failed to retrieve locations. Please Try again. : ' + data.response);
				$.mobile.hidePageLoadingMsg();
			}
		});
            /*alert('Latitude: '          + position.coords.latitude          + '\n' +
             'Longitude: '         + position.coords.longitude         + '\n' +
             'Altitude: '          + position.coords.altitude          + '\n' +
             'Accuracy: '          + position.coords.accuracy          + '\n' +
             'Altitude Accuracy: ' + position.coords.altitudeAccuracy  + '\n' +
             'Heading: '           + position.coords.heading           + '\n' +
             'Speed: '             + position.coords.speed             + '\n' +
             'Timestamp: '         + new Date(position.timestamp)      + '\n');*/
	};
        
	// onError Callback receives a PositionError object
	//
	function onError(error) {
		$.mobile.hidePageLoadingMsg();
		alert('code: '    + error.code    + '\n' +
			  'message: ' + error.message + '\n');
	}
    
    </script>

  </head>
  <body onload="onBodyLoad()">
      <div data-add-back-btn="true" data-role="page" id="mainPage">
          <div data-role="header">
              <h2>Tikal Time Tracker</h2>
          </div>
          <div data-role="content">
              <ul data-role="listview">
                  <li><a onClick="retrieveLocations();">Select Location</a></li>
              </ul>
              <p id="locationContainer"></p>
          </div>
          <div data-role="button" onClick="doCheckIn();">
              <h1>Check In</h1>
          </div>
      </div>
      <div data-add-back-btn="true" data-role="page" id="selectlocation">
          <div data-role="header" >
              <h2>Select Location</h2>
          </div>
          <div data-role="content">
              <ul class="locationlist" data-role="listview" data-split-icon="info" data-split-theme="d">
              </ul>
              <script id="locationItem" type="text/x-jquery-tmpl">
                  <li>
                  <a onclick="doSelectLocation('${id}');">
                  <h3>${name}</h3>
                  <p>${location.address}</p>
                  </a>
                  <a onclick="showMapForLocation('${id}');" data-rel="dialog" data-transition="slideup">${name}</a>
                  </li> 
                  </script> 
          </div>
          <div data-role="footer">
              <h4>Page Footer</h4>
          </div>
      </div>
      <div data-role="page" data-theme="b" id="map_page" class="page-map" data-add-back-btn="true" style="width:100%; height:100%;"> 
          <script type="text/javascript">
              
              </script>
          <div data-role="header">
              <h1>View On Map</h1>
          </div>
          <div data-role="content" style="width:100%; height:100%; padding:0;">
              <div id="map_canvas" style="width:100%; height:100%;"></div>
          </div>
      </div>
  </body>
</html>
</strong>